#!/usr/bin/env sh

clj_install() {
    ome_check_install "javac" "jvm"
    
    if [ "`command -v clojure`" = "" ]; then
        tip "install Clojure Cli"
        cd $HOME/Downloads/
        rm -rf ./linux-install-1.10.0.403.sh
        curl -O https://download.clojure.org/install/linux-install-1.10.0.403.sh
        chmod +x linux-install-1.10.0.403.sh
        mkdir -p $OME_PREFIX/lib/clojure/libexec/
        ./linux-install-1.10.0.403.sh --prefix $OME_PREFIX
    fi
    
    if [ "`command -v lein`" = "" ]; then
        tip "install leiningen"
        cd $OME_PREFIX/bin/
        rm -rf ./lein
        wget https://raw.githubusercontent.com/technomancy/leiningen/stable/bin/lein
        chmod +x ./lein
        lein --version
    else
        lein upgrade
    fi

    if [ "`command -v boot`" = "" ]; then
        tip "install boot"
        cd $OME_PREFIX/bin/
        curl -fsSLo boot https://github.com/boot-clj/boot-bin/releases/download/latest/boot.sh
        chmod +x ./boot
        boot --version
    fi
}

clj_uninstall() {
    echo_error "'clj_uninstall' not implemented"
}

clj_exist_p() {
    echo_error "'clj_exist_p' not implemented"
}

clj_info() {
    ome_show "CLJ" "`ome_fetch_version lein | cut -d ' ' -f 1-2`"
}

clj_publish_settings() {
    if [ ! -f $HOME/.lein/init.clj ]; then
        read -p "please input your username with clojas:" username
	    read -sp "please input your password with clojas:" password
        echo ""
        echo '(def settings' >> $HOME/.lein/init.clj
        echo '{:deploy-repositories {"clojars-https" {:url "https://clojars.org/repo"' >> $HOME/.lein/init.clj
        echo "                                         :username $username" >> $HOME/.lein/init.clj
        echo "                                         :password $password}}})" >> $HOME/.lein/init.clj
    fi
}
