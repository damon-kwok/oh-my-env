#!/usr/bin/env sh

PROJECT_BLOG=demo-kwok.github.io

DIR_LLVM_WHERE=$OME_ROOT/dev
DIR_LLVM=$OME_ROOT/dev/llvm

project_upgrade() {
    # C
    github_upgrade curl/curl $PROJ_ROOT/c/curl
    mkdir -p $PROJ_ROOT/c/curl/build
    cd $PROJ_ROOT/c/curl/build/
    cmake .. -G "$OME_MAKE" \
	      -DCMAKE_INSTALL_PREFIX=$OME_PREFIX \
          -DBUILD_SHARED_LIBS=0
    cmake --build . --use-stderr --config Release --target install -- -j4
    
    github_upgrade libuv/libuv $PROJ_ROOT/c/libuv
    github_upgrade nodejs/http-parser $PROJ_ROOT/c/http-parser
    github_upgrade json-c/json-c $PROJ_ROOT/c/json-c
    github_upgrade protobuf-c/protobuf-c $PROJ_ROOT/c/protobuf-c
    github_upgrade Snaipe/libcsptr $PROJ_ROOT/c/libcsptr

    # github_upgrade nanomsg/nanomsg $PROJ_ROOT/c/nanomsg
    # github_upgrade zeromq/libzmq $PROJ_ROOT/c/libzmq
    github_upgrade libcheck/check $PROJ_ROOT/c/libcheck
    github_upgrade lcm-proj/lcm $PROJ_ROOT/c/lcm
    svn_upgrade svn://vcs.exim.org/pcre2/code/trunk $PROJ_ROOT/c/pcre2
    github_upgrade Tencent/libco $PROJ_ROOT/c/libco
    github_upgrade sheredom/utf8.h $PROJ_ROOT/c/utf8.h
    
    # C++
    github_upgrade emilk/loguru $PROJ_ROOT/cpp/loguru
    github_upgrade nodejs/http2 $PROJ_ROOT/cpp/http2
    github_upgrade facebook/folly $PROJ_ROOT/cpp/folly
    github_upgrade pocoproject/poco $PROJ_ROOT/cpp/poco
    github_upgrade 01org/tbb $PROJ_ROOT/cpp/tbb
    github_upgrade Tencent/rapidjson $PROJ_ROOT/cpp/rapidjson

    github_upgrade emweb/wt $PROJ_ROOT/cpp/wt

    # Java
    github_upgrade emweb/jwt $PROJ_ROOT/java/jwt
    
    # C#

    # Lisp
    github_upgrade kanaka/mal $PROJ_ROOT/lisp/mal

    # Clojure
    github_upgrade apache/storm $PROJ_ROOT/clj/storm    
    github_upgrade riemann/riemann $PROJ_ROOT/clj/riemann
    github_upgrade ztellman/aleph $PROJ_ROOT/clj/aleph
    github_upgrade ztellman/byte-streams $PROJ_ROOT/clj/byte-streams
    github_upgrade ztellman/lamina $PROJ_ROOT/clj/lamina
    github_upgrade ztellman/gloss $PROJ_ROOT/clj/gloss
    github_upgrade ztellman/manifold $PROJ_ROOT/clj/manifold
    
    # Unity3d
    github_upgrade arcadia-unity/arcadia $PROJ_ROOT/u3d/Arcadia
    
    # UE4
    # https://github.com/EpicGames/UnrealEngine.git
    github_upgrade EpicGames/UnrealEngine $PROJ_ROOT/ue4/UnrealEngine
    
    # Data
    github_upgrade apache/thrift $PROJ_ROOT/data/thrift
    github_upgrade apache/avro $PROJ_ROOT/data/avro
    github_upgrade google/flatbuffers $PROJ_ROOT/data/flatbuffers
}

book_upgrade() {
    # Book
    # https://github.com/QianMo/Real-Time-Rendering-3rd-CN-Summary-Ebook
    github_upgrade QianMo/Real-Time-Rendering-3rd-CN-Summary-Ebook $BOOK_ROOT/Real-Time-Rendering-3rd-CN-Summary-Ebook
    # https://github.com/huangz1990/real-world-haskell-cn
    github_upgrade huangz1990/real-world-haskell-cn $BOOK_ROOT/real-world-haskell-cn

    # https://github.com/apachecn/storm-doc-zh/
    github_upgrade apachecn/storm-doc-zh $BOOK_ROOT/storm-doc-zh
    
    # https://github.com/Windfarer/mal-zh
    github_upgrade Windfarer/mal-zh $BOOK_ROOT/mal-zh

    github_upgrade norvig/paip-lisp $BOOK_ROOT/paip-lisp

}

me_upgrade() {   	
    ome_upgrade
    
    gitlab_ssh_upgrade damon-kwok/workspace $HOME/workspace
    chmod +x $HOME/.oh-my-env/*

    github_ssh_upgrade damon-kwok/damon-kwok.github.io $PROJ_ROOT/me/blog
    
    github_ssh_upgrade damon-kwok/awesome-package-manager $PROJ_ROOT/me/awesome-package-manager
    github_ssh_upgrade damon-kwok/awesome-network-programming $PROJ_ROOT/me/awesome-network-programming
    github_ssh_upgrade damon-kwok/awesome-web-scraping $PROJ_ROOT/me/awesome-web-scraping
    github_ssh_upgrade damon-kwok/medusa $PROJ_ROOT/me/medusa
    
    github_ssh_upgrade damon-kwok/libknife $PROJ_ROOT/me/libknife    
    # cd $PROJ_ROOT/c/libknife
    # mkdir -p build
    # cd build
    # cmake ..
    # make
}

me_push() {
    local oldir=`pwd`
    cd $HOME/.oh-my-emacs/
    git push
    
    cd $PROJ_ROOT/me/blog
    git_push
    
    cd $HOME/workspace
    git_push

    cd $PROJ_ROOT/me/awesome-package-manager
    git_push

    cd $PROJ_ROOT/me/awesome-network-programming
    git_push

    cd $PROJ_ROOT/me/awesome-web-scraping
    git_push
    
    cd $PROJ_ROOT/me/medusa
    git_push
    
    cd $PROJ_ROOT/me/libknife
    git_push
    cd $oldir
}

blog_push() {
    local oldir=`pwd`
    cd $PROJ_ROOT/me/blog
    git_push
    cd $oldir
}

ws_push() {
    local oldir=`pwd`
    cd $HOME/.oh-my-env
    git_push
    cd $oldir
}

daily_upgrade() {
    local oldir=`pwd`
    # tip "upgrade oh-my-emacs"
    cd $HOME/.oh-my-emacs/
    git pull
    
    tip "pip upgrade"
    pip2 install --user -U pip
    pip3 install --user -U pip
    
    # erlang_install
    # elixir_install
    llvm_install
    # rtags_install
    # cquery_install
    # ccls_install
    mu4e_install
    
    # project-upgrade
    # book-upgrade
    cd $oldir
}
